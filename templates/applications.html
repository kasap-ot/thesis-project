{% extends 'base.html' %}
{% block content %}

<div class="container w-75">
    <h2>My applications</h2>

    <ul class="list-group">
        <li class="list-group-item bg-primary text-light fw-bold">
            <div class="container text-center">
                <div class="row py-2">
                    <div class="col">Student ID</div>
                    <div class="col">Offer ID</div>
                    <!-- TODO - country functionality -->
                    <!-- TODO - display brief offer info (company, field, etc.) -->
                    <div class="col">Status</div>
                    <div class="col">Action</div>
                </div>
            </div>
        </li>
        {% for application in applications %}
        {% set status = application.status.value %}
        <!-- 
            * status == 0 - status is 'waiting'
            * status == 1 - status is 'accepted'
            * status == 2 - status is 'rejected'
         -->
        {% if status == 0 %}
            {% set list_item_color = "warning" %}
            {% set button_styles = "btn btn-danger cancel-btn" %}
            {% set button_id = "cancel-btn-" ~ application.student_id ~ "-" ~ application.offer_id %}
            {% set button_text = "Cancel" %}
            {% set status_text = "Waiting" %}
        {% elif status == 1 %}
            {% set list_item_color = "success" %}
            {% set button_styles = "btn btn-danger cancel-btn" %}
            {% set button_id = "cancel-btn-" ~ application.student_id ~ "-" ~ application.offer_id %}
            {% set button_text = "Cancel" %}
            {% set status_text = "Accepted" %}
        {% else %}
            {% set list_item_color = "danger" %}
            {% set button_id = "none-btn-" ~ application.student_id ~ "-" ~ application.offer_id %}
            {% set button_styles = "btn btn-secondary" %}
            {% set button_text = "None" %}
            {% set status_text = "Rejected" %}
        {% endif %}
        <li class="list-group-item list-group-item-action list-group-item-{{list_item_color}}">
            <div class="container text-center">
                <div class="row py-2 align-items-center">
                    <div class="col">{{application.student_id}}</div>
                    <div class="col">{{application.offer_id}}</div>
                    <div class="col">{{status_text}}</div>
                    <div class="col">
                        <button class="{{button_styles}}" id="{{button_id}}">
                            {{button_text}}
                        </button>
                    </div>
                </div>
            </div>
        </li>
        {% endfor %}
    </ul>

    <!-- <a href="/offers" class="btn btn-secondary mt-2"><i class="bi bi-arrow-left"></i> Offers</a> -->
    <button class="btn btn-secondary mt-2" id="home-btn">
        <i class="bi bi-arrow-left"></i> Home
    </button>
</div>

<script>
    document.getElementById('home-btn')
        .addEventListener('click', async () => {
            await access('/students-home', 'GET')
        })

    document.querySelectorAll('.cancel-btn').forEach(async button => {
        button.addEventListener('click', async () => {
            // ID format: cancel-btn-[student_id]-[offer_id]
            const buttonIdParts = button.id.split('-')
            const student_id = buttonIdParts[2]
            const offer_id = buttonIdParts[3]
            await access(`/applications/cancel/${student_id}/${offer_id}`, 'DELETE')
            await access(`/applications/view/${student_id}`, 'GET')
        })
    })
</script>

{% endblock %}